---
title: 图像格式之 YUV & RGB
date: 2023-4-13 12:56:11
categories: 笔记
tags: 嵌入式
comments: false
description:
typora-root-url: 2-YUV&RGB
---

<div align = "center">图像格式之 YUV & RGB</div>

# 一、图像颜色空间介绍

## 1.RGB

采样与编码格式

R、G、B分别代表red、green、blue，三原色。将他们按照不同比例叠加，可得到更多不同颜色。

![](1.png)

每个像素点的颜色由R、G、B三原色表示。每一个颜色通道（原色）包含2^8= 256种不同的红/绿/蓝（八位二进制），占用8bit，也就是一字节，那么一个像素点也就占用了3字节。

<!--more-->

图片大小计算：一张 1280 * 720 大小的图片，就占用 1280 * 720 * 3 / 1024 / 1024 = 2.63 MB 存储空间。

```c
//RGB常见的的几种格式和描述：
RGB565 每个像素用16位表示，RGB分量各使用5位、6位、5位；
RGB555 每个像素用16位表示，RGB分量都使用5位（剩下1位不用）；
RGB24 每个像素用24位表示，RGB分量各使用8位；
RGB32 每个像素用32位表示，RGB分量各使用8位（剩下8位不用）；
ARGB32 每个像素用32位表示，RGB分量各使用8位（剩下的8位用于表示Alpha(透明度)通道值）；
```

常见的RGB格式有：RGB_565、RGB_888、ARGB_8888、ARGB_4444等。但是也有列外，尤其是搞安卓的同学要特别注意，谷歌在这里给我们挖了一个坑，那就是，ARGB_8888和ARGB_4444实际上在底层对应的是 RGBA_8888和RGBA_4444，例如ARGB_8888图像，其像素数据在内存中其实是以R G B A R G B A …的顺序排布的。

## 2.YUV

简介：与我们熟知的RGB类似，YUV也是一种颜色编码方法；主要用于电视系统以及模拟视频领域，它将亮度信息（Y）与色彩信息（UV）分离，没有UV信息一样可以显示完整的图像，只不过是黑白的，

这样的设计很好地解决了彩色电视机与黑白电视的兼容问题。并且，YUV不像RGB那样要求三个独立的视频信号同时传输，所以用YUV方式传送占用极少的频宽。

### 1）颜色空间

在YUV颜色空间中，YUV（YCbCr ）格式也包含三个分量：
		Y——明亮度（Luma），也成灰阶，没有UV分量也可成像，图像是黑白的（基础信号）
		UV——色度（Chroma）：色彩+色彩饱和度（正交调制信号）

每个 Y 分量可以都有自己对应的 UV 分量，也可以几个 Y 分量共用 UV 分量，这就是为何会有YUV4:4:4、YUV4:2:2、YUV4:2:0采样格式出现，用于减小图像包含的数据量大小，便于传输和存储。

![](2.png)

```c
//YUV种类分为很多，可以理解是一个二维的，即空间间，和空间内，这样的表述，借鉴了h264中的帧间和帧内的思想。
空间-间：不同空间，即描述一个像素的bit数不同，比如yuv444，yuv422，yuv411，yuv420
空间-内：相同空间，即描述一个像素的bit数相同，但是存储方式不同，比如对于yuv420而言，又可细分为yuv420p，yuv420sp，nv21，nv12，yv12，yu12，I420
//为什么yuv444，yuv420，yuv422，yuv411都是用的4呢？
-->因为用到了共享的思想，这是yuv和rgb的本质区别.
rgb是一个像素是一个家庭，家庭成员是r，g，b，但是yuv是若干像素是一个家庭，不同像素的y共享同一个u和v，这样，引入了共享的思想，虽然最小单位是一个字节，但实际上描述一个像素点的字节，不一定是字节的整数倍
```

### 2）采样格式

#### YUV 444

YUV三个信道的信号全采样，每个像素的三个分量信息完整（每个分量一般用8bit），因此每个像素经量化后，未经压缩，占用3字节。

```c
[yuv][yuv][yuv][yuv]
[yuv][yuv][yuv][yuv]
[yuv][yuv][yuv][yuv]
[yuv][yuv][yuv][yuv]
//一个家庭成员是[yuv]，每个Y对应一组UV，一个YUV占24bits 3个字节；

//假设四个像素为:	[Y0 U0 V0] [Y1 U1 V1] [Y2 U2 V2] [Y3 U3 V3]
//存放的码流为:	Y0 U0 V0 Y1 U1 V1Y2 U2 V2Y3 U3 V3
```



#### YUV 422

亮度Y分量保持不变；对UV分量进行采样，数据量减小一半。

```c
[yu][yv][yu][yv]
[yv][yu][yv][yu]
[yu][yv][yu][yv]
[yv][yu][yv][yu]
//一个家庭成员是[yu] [yv]，也就是2个Y公用一个UV，一个YUV占8+4+4=16bits 2个节。

//假设四个像素为:[Y0 U0 V0] [Y1 U1 V1] [Y2 U2 V2] [Y3 U3 V3]
//采样码流为：[Y0 U0 ] [Y1 V1] [Y2 U2 ] [Y3 V3]
```

隔行扫描，行1出U分量，那么下一行行2则出V分量（即UV分量按照1:1的比例进行采样），最终相邻两个Y分量共用一组UV分量。

#### YUV 420

亮度Y分量保持不变；对UV分量进行采样，数据量只有1/4

``` c
//吐槽:yuv420的意思似乎是在yuv422的基础上，再拿掉两个v，这样不就没有v了吗？其实yuv420的取名方式不是很高明，更确切的命名为yuv420yuv402也就是第一行只有两个u，而第二行只有两个v，如下图；
```

```c
[yu][y][yu][y]
[yv][y][yv][y]
[yu][y][yu][y]
[yv][y][yv][y]
//一个家庭成员是[yu][y],4个Y公用一组UV，每个YUV占用8+2+2=12bits，1.5个字节；
//			  [yv][y]
//假设八个像素为:[Y0 U0 V0] [Y1 U1 V1] [Y2 U2 V2] [Y3 U3 V3]
//			   [Y5 U5 V5] [Y6 U6 V6] [Y7 U7 V7] [Y8 U8 V8]
//采样码流为：[Y0 U0 ] [Y1 ] [Y2 U2 ] [Y3 ]
//			[Y5 V5] [Y6 ] [Y7 V7] [Y8 ]
//存放的码流为:
//			[Y0 U0 V5] [Y1 U0 V5] [Y2 U2 V7] [Y3 U2 V7]
//			[Y5 U0 V5] [Y6 U0 V5] [Y7 U2 V7] [Y8 U2 V7]
```

隔行扫描，且UV分量按照2:1的比例进行采样，第一个像素保留一半U/(V)数据，相邻第二个像素U和V分量全舍弃，第三个像素采集第二次U/(V)数据，第四个像素U和V分量全舍弃，第五个像素采集第一次V/(U)，最终相邻四个Y分量共用一组UV分量，而且是按照 2*2 的小方格的形式分布。

#### 图示：

![](3.png)

黑点表示采样该像素点的Y分量，以空心圆圈表示采用该像素点的UV分量。
		YUV 4:4:4采样，每一个Y对应一组UV分量。
		YUV 4:2:2采样，每两个Y共用一组UV分量。
		YUV 4:2:0采样，每四个Y共用一组UV分量，如图中的红色部分。

### 3)图像大小计算

假设一幅图像，像素大小为1280*720

YUV 4:4:4采样，(1280 * 720 * 3) / 1024 / 1024 ≈2.64M

YUV 4:2:2采样，(1280 * 720 * 2) / 1024 / 1024 ≈1.76M

YUV 4:2:0采样，(1280 * 720 * 3 / 2) / 1024 / 1024 ≈1.32M

### 4）存储格式

#### planar

平面格式：指连续存储所有像素点的Y分量，然后存储U分量，最后是V分量，3个plane。

#### packed 

打包模式：指每个像素点的Y、U、V分量是连续交叉存储的，1个plane。

#### semi-planar:

Y连续存储，U、V交叉存储，如NV21、NV12，即2个plane。

#### 图示：

| YUV444 | YUV422         | YUV420         | YUV411 |
| ------ | -------------- | -------------- | ------ |
|        | YU16(YUV422P)  | YU12(YUV420P)  |        |
|        | YV16(YUV422P)  | YV12(YUV420P)  |        |
|        | NV16(YUV422SP) | NV12(YUV420SP) |        |
|        | NV61(YUV422SP) | NV21(YUV420SP) |        |
|        | YUYV422        |                |        |
|        | UYVY           |                |        |

# 二、图像格式介绍

## 1.RGB

### 1.RGB555(高彩色)

​    RGB555是一种16位的RGB格式，R、G、B分量都用5位来表示，剩下的一位不用，存储格式如下图：

![](4.png)

```c
//假设计算机中存储某一个像素点的变量为color, 数据类型为short.，那么则有：

R = color & 0x7C00, (获取高字节的5个bit)
G = color & 0x03E0, (获取中间5个bit)
B = color & 0x001F, (获取低字节5个bit)
```

### 2.RGB565(高彩色)

   RGB565同样是一种16位的RGB格式，R和B分量用5位来表示，G分量用6位标志。存储格式如下图：

![](5.png)

```c
//假设计算机中存储某一个像素点的变量为color, 数据类型为short， 那么则有：

R = color & 0xF800, (获取高字节的5个bit)
G = color & 0x07E0, (获取中间6个bit)
B = color & 0x001F, (获取低字节5个bit)
```

### 3.RGB24(真彩色)

RGB24是一种24位的RGB格式，R、G、B分量都用8位来表示，每位取值范围都为0-255。存储格式如下图：

![](6.png)

```c
//假设计算机中存储某一个像素点的变量为color, 数据类型为int， 那么则有：
    
R = color & 0x000000FF,
G = color & 0x0000FF00,
B = color & 0x00FF0000,
```

### 4.RGB32(真彩色)

  RGB32使用32位来表示一个像素，RGB分量各用去8位，剩下的8位用作Alpha通道或者不用。Alpha通道是一个8位的灰度通道，该通道用256级灰度来记录图像中的透明度信息，定义透明、不透明和半透明区域，其中白表示不透明，黑表示透明，灰表示半透明。其结构如下：

![](7.png)

```c
//假设计算机中存储某一个像素点的变量为color, 数据类型为int，那么则有:
a、低8位保留
R = color & 0x0000FF00
G = color & 0x00FF0000,
B = color & 0xFF000000,
b、低8位为ALPHA值
R = color & 0x0000FF00,
G = color & 0x00FF0000,
B = color & 0xFF000000,
A = color & 0x000000FF,
```



## 2.YUV

### 1.YUV420SP

#### 1.NV12 

NV21图像格式属于 YUV颜色空间中的YUV420SP格式，每四个Y分量共用一组U分量和V分量，Y连续排序，U与V交叉排序。

```c
//排列方式如：
Y Y   Y Y   Y Y   Y Y
Y Y   Y Y   Y Y   Y Y
Y Y   Y Y   Y Y   Y Y
Y Y   Y Y   Y Y   Y Y

V U   V U   V U  V U
V U   V U   V U  V U
```

####  2.NV21

NV12图像格式属于 YUV颜色空间中的YUV420SP格式，每四个Y分量共用一组U分量和V分量，Y连续排序，U与V交叉排序（NV12和NV21只是U与V的位置相反）。

```c
//排列方式如：
Y Y   Y Y   Y Y   Y Y
Y Y   Y Y   Y Y   Y Y
Y Y   Y Y   Y Y   Y Y
Y Y   Y Y   Y Y   Y Y

U V   U V   U V  U V
U V   U V   U V  U V
```

```c
//NV12: YYYYYYYY UVUV =>YUV420SP
//NV21: YYYYYYYY VUVU =>YUV420SP
```

### 2.YUV420P

#### 1.YU12

YU12图像格式属于 YUV颜色空间中的YUV420P格式，每四个Y分量共用一组U分量和V分量，Y、U、V各自连续排序。

```c
//排列方式如：
Y Y   Y Y   Y Y   Y Y
Y Y   Y Y   Y Y   Y Y
Y Y   Y Y   Y Y   Y Y
Y Y   Y Y   Y Y   Y Y

U     U     U     U
U     U     U     U

V     V     V     V
V     V     V     V
```

#### 2.YV12

YV12图像格式属于 YUV颜色空间中的YUV420P格式，每四个Y分量共用一组U分量和V分量，Y、U、V各自连续排序（YV12和I420只是U与V的位置相反）。

```c
//排列方式如：
Y Y   Y Y   Y Y   Y Y
Y Y   Y Y   Y Y   Y Y
Y Y   Y Y   Y Y   Y Y
Y Y   Y Y   Y Y   Y Y

V     V     V     V
V     V     V     V

U     U     U     U
U     U     U     U
```

```c
//YU12: YYYYYYYY UU VV =>YUV420P
//YV12: YYYYYYYY VV UU =>YUV420P
```

### 3．YUYV图像格式（打包格式存储）

YUYV图像格式属于 YUV颜色空间中的YUV422格式，每两个Y分量共用一组U分量和V分量，Y、U、V交叉排序。

```c
//排列方式如：
Y U Y V   Y U Y V   Y U Y V   Y U Y V

Y U Y V   Y U Y V   Y U Y V   Y U Y V

Y U Y V   Y U Y V   Y U Y V   Y U Y V

Y U Y V   Y U Y V   Y U Y V   Y U Y V
```



# 三、RGB与YUV的格式转换

图像显示器——通过RGB模型显示图像

传输图像数据——通过YUV模型传输 （YUV 模型可以节省带宽）

![](8.png)

## 转换公式：

1.小数形式, YUV  ( U∈[-0.5-0.5] ,  R，G，B∈[0,1] )

```c
Y =  0.299*R + 0.587*G + 0.114*B;
U = -0.169*R - 0.331*G + 0.5  *B ;
V =  0.5  *R - 0.419*G - 0.081*B;
```

```c
R = Y + 1.4075 * V;  
G = Y - 0.3455 * U - 0.7169*V;  
B = Y + 1.779 * U; 
```

# 四：一图看RGB与YUV

## RGB格式

 ![](9.jpg)

## YUV格式

![](10.jpg)

## YUV存储格式

![](11.jpg)

## ARGB

![](12.jpg)

...

...